{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { Peer, DataConnection } from \"peerjs\";\r\n\r\nexport type TRINNError = {\r\n  name: string;\r\n  message: string;\r\n  type: string;\r\n};\r\n\r\nclass TRINNPeer {\r\n  peer: Peer;\r\n  id: string | undefined;\r\n  error: TRINNError | undefined;\r\n\r\n  constructor(requiredId: string) {\r\n    this.peer = new Peer(requiredId);\r\n    this.peer.on(\"open\", (id) => {\r\n      this.id = id;\r\n    });\r\n    this.peer.on(\"error\", ({ message, type, name }) => {\r\n      this.error = { message, type, name };\r\n    });\r\n  }\r\n}\r\n\r\nexport class TRINNController extends TRINNPeer {\r\n  connection: DataConnection | undefined;\r\n\r\n  constructor(sharedId: string) {\r\n    super(`${sharedId}-controller`);\r\n    this.peer.on(\"open\", (id) => {\r\n      this.id = id;\r\n      this.connection = this.peer.connect(`${sharedId}-remote`);\r\n    });\r\n  }\r\n\r\n  sendPress(keyName: string) {\r\n    this.connection?.send({ key: keyName, type: \"press\" });\r\n  }\r\n\r\n  sendRelease(keyName: string) {\r\n    this.connection?.send({ key: keyName, type: \"release\" });\r\n  }\r\n}\r\n\r\nexport class TRINNRemote extends TRINNPeer {\r\n  private pressCallback: ((key: string) => void) | undefined;\r\n  private releaseCallback: ((key: string) => void) | undefined;\r\n\r\n  constructor(sharedId: string) {\r\n    super(`${sharedId}-remote`);\r\n    this.peer.on(\"connection\", (connection) => {\r\n      connection.on(\"data\", (data) => {\r\n        const { key, type } = data as { key: string; type: string };\r\n        if (type === \"press\") this.pressCallback?.(key);\r\n        if (type === \"release\") this.releaseCallback?.(key);\r\n      });\r\n    });\r\n  }\r\n\r\n  onPress(onPressCallback: (key: string) => void) {\r\n    this.pressCallback = onPressCallback;\r\n  }\r\n\r\n  onRelease(onReleaseCallback: (key: string) => void) {\r\n    this.releaseCallback = onReleaseCallback;\r\n  }\r\n}\r\n"],"mappings":";AAAA,SAAS,YAA4B;AAQrC,IAAM,YAAN,MAAgB;AAAA,EAKd,YAAY,YAAoB;AAC9B,SAAK,OAAO,IAAI,KAAK,UAAU;AAC/B,SAAK,KAAK,GAAG,QAAQ,CAAC,OAAO;AAC3B,WAAK,KAAK;AAAA,IACZ,CAAC;AACD,SAAK,KAAK,GAAG,SAAS,CAAC,EAAE,SAAS,MAAM,KAAK,MAAM;AACjD,WAAK,QAAQ,EAAE,SAAS,MAAM,KAAK;AAAA,IACrC,CAAC;AAAA,EACH;AACF;AAEO,IAAM,kBAAN,cAA8B,UAAU;AAAA,EAG7C,YAAY,UAAkB;AAC5B,UAAM,GAAG,QAAQ,aAAa;AAC9B,SAAK,KAAK,GAAG,QAAQ,CAAC,OAAO;AAC3B,WAAK,KAAK;AACV,WAAK,aAAa,KAAK,KAAK,QAAQ,GAAG,QAAQ,SAAS;AAAA,IAC1D,CAAC;AAAA,EACH;AAAA,EAEA,UAAU,SAAiB;AAnC7B;AAoCI,eAAK,eAAL,mBAAiB,KAAK,EAAE,KAAK,SAAS,MAAM,QAAQ;AAAA,EACtD;AAAA,EAEA,YAAY,SAAiB;AAvC/B;AAwCI,eAAK,eAAL,mBAAiB,KAAK,EAAE,KAAK,SAAS,MAAM,UAAU;AAAA,EACxD;AACF;AAEO,IAAM,cAAN,cAA0B,UAAU;AAAA,EAIzC,YAAY,UAAkB;AAC5B,UAAM,GAAG,QAAQ,SAAS;AAC1B,SAAK,KAAK,GAAG,cAAc,CAAC,eAAe;AACzC,iBAAW,GAAG,QAAQ,CAAC,SAAS;AAnDtC;AAoDQ,cAAM,EAAE,KAAK,KAAK,IAAI;AACtB,YAAI,SAAS;AAAS,qBAAK,kBAAL,8BAAqB;AAC3C,YAAI,SAAS;AAAW,qBAAK,oBAAL,8BAAuB;AAAA,MACjD,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AAAA,EAEA,QAAQ,iBAAwC;AAC9C,SAAK,gBAAgB;AAAA,EACvB;AAAA,EAEA,UAAU,mBAA0C;AAClD,SAAK,kBAAkB;AAAA,EACzB;AACF;","names":[]}